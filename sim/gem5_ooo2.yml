CPU:
# set both window_size and issueq_size to 1 for inorder cpu, 
# don't support dual-issue inorder now
  window_size: 2 # for fetch, 16 B/cycle -> 4 inst/cycle
  retire_size: 2
  flush_penalty: 6
  rob_size: 64 # set rob_size to 1 to disable inorder cpu pipeline
  clock_speed: 3300
  issueq_size: 32
  naive: false
  ldq_size: 32
  stq_size: 20
  int_phy_regs: 64
  fp_phy_regs: 64
  lsu_port: 4
L1Cache:
  latency: 4
  assoc: 8
  size: 32768
  cl_size: 64
  mshr_size: 32
  store_ports: 4 # 32 B/cycle, 4 double
  load_ports: 8 # 64 B / cycle, 8 double
L1ICache:
  latency: 4
  assoc: 8
  size: 32768
  cl_size: 64
  mshr_size: 32
  store_ports: 1 #no use
  load_ports: 1 # fetch a cache line each time
L2Cache:
  latency: 12 # latency only in l2, the total is 13, which is measured
  assoc: 16
  size: 1048576
  cl_size: 64
  mshr_size: 32
  store_ports: 8
  load_ports: 8
L3Cache:
  latency: 35 # total is 48
  assoc: 16 
  size: 8388608
  cl_size: 64
  mshr_size: 32
  store_ports: 4
  load_ports: 4
DRAM:
  simple: true
  latency: 160  # total is 166
  bw: 25
  system : "/staff/haoxiaoyu/uarch_exp/simulator/sim/DDR3_micron_16M_8B_x8_sg3.txt"
  device : "/staff/haoxiaoyu/uarch_exp/simulator/sim/DDRsys.txt"
BPred:
  bhtSize: 1024
  type: bp_tage
  ghrSize: 10

# Optional: STONNE / NPU (cosim accelerator) configuration
STONNE:
  dma_to_l2: false
NPU:
  ms_rows: 16
  ms_cols: 16
  dn_bw: 32
  rn_bw: 64
  T_N: 16
  T_M: 16
  T_K: 16
  rn_type: TEMPORALRN
  mn_type: WS_MESH
  mem_ctrl: TPU_OS_DENSE
  dataflow: DATAFLOW_WS
  M: 0
  N: 0
  K: 0
  accumulation_buffer_enabled: true
ports:
  port0:
    fu0: INTALU
  port1:
    fu0: BRU
  port2:
    fu0: INTDIV
    # fu1: INTMUL
  port3:
    fu0: FPDIV 
    # fu1: FPMUL
  port4:
    fu0: LU
    fu0: SU
  port5:
    fu0: FPALU
  port6:
    fu1: INTMUL
  port7:
    fu1: FPMUL

not_pipeline_fu:
  #- INTALU
  - INTDIV
  #- FPMUL
  - FPDIV
  #- FPALU
  #- BRU
  #- INTMUL
  #- AGU
  #- LU
  #- SU
instructions:
  ret:
    ports: "1"
    fu: BRU
    opcode_num: 1
    runtime_cycles: 1
  br: #TODO: cond and uncond
    ports: "1"
    fu: BRU
    opcode_num: 2
    runtime_cycles: 1
  switch: #TODO: this is dynamic, but not one comp and one br
    ports:  "1"
    fu: 
      - BRU
    opcode_num: 3
    runtime_cycles: 1
  # indirectbr:
  #   ports: "06"
  #   fu: BRU
  #   opcode_num: 4
  #   runtime_cycles: 1
  invoke:
    ports: "1"
    fu: BRU
    opcode_num: 5
    runtime_cycles: 3
  resume:
    ports: "1"
    fu: BRU
    opcode_num: 6
    runtime_cycles: 7
  unreachable:
    ports: "1"
    fu: BRU
    opcode_num: 7
    runtime_cycles: 0
  fneg: # xorps/fchs in x86
    ports: "0"
    fu: INTALU
    opcode_num: 12
    runtime_cycles: 1
  add:
    ports: "0"
    fu: INTALU
    opcode_num: 13 
    runtime_cycles: 1
  fadd:
    ports: 1*5
    fu: 
      - FPALU
    opcode_num: 14 
    runtime_cycles: 3
  sub:
    ports: "0"
    fu: INTALU
    opcode_num: 15
    runtime_cycles: 1
  fsub:
    ports: 1*5
    fu: 
      - FPALU
    opcode_num: 16
    runtime_cycles: 3
  mul:
    ports: "6"
    fu: INTMUL
    opcode_num: 17
    runtime_cycles: 3
  fmul:
    ports: "7"
    fu: 
      - FPMUL
      # - FMA  # try to use fma if fp mul is not avaliable
    opcode_num: 18
    runtime_cycles: 3
  udiv:
    ports: 1*2
    fu: INTDIV
    opcode_num: 19
    runtime_cycles: 20
  sdiv:
    ports: 1*2
    fu: INTDIV
    opcode_num: 20
    runtime_cycles: 20
  fdiv:
    ports: 1*3
    fu: FPDIV
    opcode_num: 21
    runtime_cycles: 12
  urem: # same as div
    ports: 1*2
    fu: INTDIV
    opcode_num: 22
    runtime_cycles: 20
  srem:
    ports: 1*2
    fu: INTDIV
    opcode_num: 23
    runtime_cycles: 20
  frem:
    ports: 1*3
    fu: FPDIV
    opcode_num: 24
    runtime_cycles: 12
  shl:
    ports: "0"
    fu: INTALU
    opcode_num: 25
    runtime_cycles: 1
  lshr:
    ports: "0"
    fu: INTALU
    opcode_num: 26
    runtime_cycles: 1
  ashr:
    ports: "0"
    fu: INTALU
    opcode_num: 27
    runtime_cycles: 1
  and:
    ports: "0"
    fu: INTALU
    opcode_num: 28
    runtime_cycles: 1
  or:
    ports: "0"
    fu: INTALU
    opcode_num: 29
    runtime_cycles: 1
  xor:
    ports: "0"
    fu: INTALU
    opcode_num: 30
    runtime_cycles: 1
  alloca:
    ports: "0"
    fu: INTALU
    opcode_num: 31
    runtime_cycles: 1
  load:
    ports: 1*4
    fu: LU
    opcode_num: 32
    runtime_cycles: 1
  store:
    ports: 1*4
    fu: SU
    opcode_num: 33
    runtime_cycles: 1
  getelementptr: # use add? 
    ports: 1*0
    fu: INTALU
    opcode_num: 34
    runtime_cycles: 1
  # fence:
  #   ports: "012"
  #   opcode_num: 35
  #   runtime_cycles: 0
  trunc:
    ports: "0"
    fu: INTALU
    opcode_num: 38
    runtime_cycles: 1
  zext:
    ports: "0"
    fu: INTALU
    opcode_num: 39
    runtime_cycles: 0
  sext:
    ports: "0"
    fu: INTALU
    opcode_num: 40
    runtime_cycles: 0
  fptoui:
    ports: 1*5
    fu: 
      - FPALU
    opcode_num: 41
    runtime_cycles: 3
  fptosi:
    ports: 1*5
    fu: 
      - FPALU
    opcode_num: 42
    runtime_cycles: 3
  uitofp:
    ports: 1*5
    fu: 
      - FPALU
    opcode_num: 43
    runtime_cycles: 3
  sitofp:
    ports: 1*5
    fu: 
      - FPALU
    opcode_num: 44
    runtime_cycles: 3
  fptrunc:
    ports: 1*5
    fu:
      - FPALU
    opcode_num: 45
    runtime_cycles: 3
  fpext: 
    ports: 1*5
    fu:
      - FPALU
    opcode_num: 46
    runtime_cycles: 1
  ptrtoint: #like mov
    ports: "0"
    fu: INTALU
    opcode_num: 47
    runtime_cycles: 1
  inttoptr:
    ports: "0"
    fu: INTALU
    opcode_num: 48
    runtime_cycles: 1
  bitcast: # like mov?
    ports: "0"
    fu: INTALU
    opcode_num: 49
    runtime_cycles: 1
  # addrspacecast:
  #   ports: "0156"
  #   opcode_num: 50
  #   runtime_cycles: 0
  icmp:
    ports: "0"
    fu: INTALU
    opcode_num: 54
    runtime_cycles: 1
  fcmp:
    ports: "5"
    fu:
      - FPALU
    opcode_num: 55
    runtime_cycles: 1
  phi: #treat it as mov
    ports: "0"
    fu: INTALU
    opcode_num: 56
    runtime_cycles: 1
  call:
    ports: "1"
    fu: 
      - BRU
    opcode_num: 57
    runtime_cycles: 1
  select:
    ports: "1" # do it as a compare and a move
    fu: BRU
    opcode_num: 58
    runtime_cycles: 1
  landingpad:
    ports: "0"
    fu: INTALU 
    opcode_num: 66
    runtime_cycles: 1
  extractelement:
    ports: "0"
    fu: INTALU
    opcode_num: 61
    runtime_cycles: 1
  insertelement:
    ports: "0"
    fu: INTALU
    opcode_num: 62
    runtime_cycles: 1
  extractvalue:
    ports: "0"
    fu: INTALU
    opcode_num: 64
    runtime_cycles: 1
  insertvalue:
    ports: "0"
    fu: INTALU
    opcode_num: 65
    runtime_cycles: 1
  freeze:
    ports: "0"
    fu: INTALU
    opcode_num: 67
    runtime_cycles: 1
